function initializeApp(){const e=localStorage.getItem("currentProject");e?(currentProject=JSON.parse(e),updateProjectUI()):updateProjectUI(),loadProjectsFromDB()}function setupEventListeners(){document.getElementById("save-btn").addEventListener("click",saveProject),document.getElementById("reedit-btn").addEventListener("click",reeditProject),document.getElementById("criticize-btn").addEventListener("click",criticizeProject),document.getElementById("test-btn").addEventListener("click",testHypothesis),document.getElementById("add-block-btn").addEventListener("click",addNewBlock),document.getElementById("remove-block-btn").addEventListener("click",removeSelectedBlock),document.getElementById("new-project-btn").addEventListener("click",newProject),document.getElementById("my-projects-btn").addEventListener("click",showProjectsModal),document.getElementById("delete-project-btn").addEventListener("click",deleteProject),document.getElementById("export-pdf-btn").addEventListener("click",exportToPDF),document.getElementById("help-btn").addEventListener("click",showHelp),document.querySelector(".close-btn").addEventListener("click",closeModal),window.addEventListener("click",e=>{e.target===document.getElementById("projects-modal")&&closeModal()}),document.querySelectorAll("[data-lang]").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),changeLanguage(e.target.dataset.lang)})}),document.getElementById("dark-mode-toggle").addEventListener("change",toggleDarkMode),document.getElementById("project-name").addEventListener("input",e=>{currentProject.nome=e.target.value,updateProjectStatus("Novo")})}function updateProjectUI(){document.getElementById("project-name").value=currentProject.nome,document.getElementById("project-status").textContent=currentProject.status,renderBlocks(),localStorage.setItem("currentProject",JSON.stringify(currentProject))}function renderBlocks(){const e=document.getElementById("canvas");e.innerHTML="",0!==currentProject.blocos.length?currentProject.blocos.forEach(t=>{const n=createBlockElement(t);e.appendChild(n)}):e.innerHTML='<p class="empty-canvas">Selecione um framework e template para começar ou adicione blocos manualmente.</p>'}function createBlockElement(e){const t=document.createElement("div");t.className="block",t.dataset.id=e.id,selectedBlockId===e.id&&t.classList.add("selected"),t.innerHTML=`\n        <h3 class="block-title">${e.titulo}</h3>\n        <div class="block-guide">${e.textoGuia}</div>\n        <textarea class="block-textarea" placeholder="Adicione suas anotações aqui...">${e.textoUsuario||""}</textarea>\n    `,t.addEventListener("click",()=>selectBlock(e.id));const n=t.querySelector(".block-textarea");return n.addEventListener("input",t=>{updateBlockText(e.id,t.target.value)}),t}function selectBlock(e){selectedBlockId=e,document.querySelectorAll(".block").forEach(e=>{e.classList.remove("selected")}),document.querySelector(`.block[data-id="${e}"]`).classList.add("selected")}function updateBlockText(e,t){const n=currentProject.blocos.find(t=>t.id===e);n&&(n.textoUsuario=t,updateProjectStatus("Novo"))}function updateProjectStatus(e){currentProject.status=e,document.getElementById("project-status").textContent=e}function generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}function saveProject(){const e=confirm("Deseja salvar o projeto localmente (IndexedDB) ou no servidor?\n\nOK para Local, Cancelar para Servidor (futuro)");e?saveProjectToDB(currentProject).then(()=>{currentProject.salvoEm="local",currentProject.ultimaAtualizacao=(new Date).toISOString(),updateProjectStatus("Salvo"),alert("Projeto salvo localmente com sucesso!")}).catch(e=>{console.error("Erro ao salvar projeto:",e),alert("Erro ao salvar projeto localmente.")}):(currentProject.salvoEm="servidor",currentProject.ultimaAtualizacao=(new Date).toISOString(),updateProjectStatus("Salvo"),alert("Função de salvamento no servidor será implementada futuramente com PHP + MySQL."))}function reeditProject(){const e=confirm("Deseja realmente Reeditar o Projeto Inteiro?");e&&(currentProject.blocos=[],currentProject.framework="",currentProject.template="",updateProjectStatus("Novo"),renderBlocks())}function criticizeProject(){const e={...currentProject,timestamp:(new Date).toISOString()};console.log("Dados para crítica (JSON):",JSON.stringify(e,null,2)),alert("JSON gerado para crítica. Verifique o console do navegador.")}function testHypothesis(){const e={project:currentProject,blocks:currentProject.blocos.map(e=>({id:e.id,title:e.titulo,userNotes:e.textoUsuario})),timestamp:(new Date).toISOString()};console.log("Dados para teste de hipótese (JSON):",JSON.stringify(e,null,2)),alert("Estrutura para teste de hipótese gerada. Verifique o console do navegador.")}function newProject(){const e=confirm("Deseja salvar as modificações feitas no projeto atual?");e&&saveProject(),currentProject={id:generateUUID(),nome:"Novo Projeto",status:"Novo",idioma:currentLang,framework:"",template:"",blocos:[],salvoEm:"",ultimaAtualizacao:(new Date).toISOString()},selectedBlockId=null,updateProjectUI()}function deleteProject(){const e=confirm("Tem certeza que deseja deletar este projeto?");e&&deleteProjectFromDB(currentProject.id).then(()=>{newProject(),alert("Projeto deletado com sucesso!")}).catch(e=>{console.error("Erro ao deletar projeto:",e),alert("Erro ao deletar projeto.")})}function showProjectsModal(){const e=document.getElementById("projects-modal");e.style.display="block",loadProjectsList()}function closeModal(){document.getElementById("projects-modal").style.display="none"}function showHelp(){const e=document.getElementById("canvas");e.innerHTML='\n        <div class="help-content">\n            <h2>Ajuda - GearHub</h2>\n            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam auctor, nisl eget ultricies tincidunt, nisl nisl aliquam nisl, eget ultricies nisl nisl eget nisl.</p>\n            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam auctor, nisl eget ultricies tincidunt, nisl nisl aliquam nisl, eget ultricies nisl nisl eget nisl.</p>\n            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam auctor, nisl eget ultricies tincidunt, nisl nisl aliquam nisl, eget ultricies nisl nisl eget nisl.</p>\n            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam auctor, nisl eget ultricies tincidunt, nisl nisl aliquam nisl, eget ultricies nisl nisl eget nisl.</p>\n        </div>\n    '}function changeLanguage(e){currentLang=e,currentProject.idioma=e,applyLanguage(),updateProjectStatus("Novo")}function applyLanguage(){document.title=i18n[currentLang].appTitle,document.getElementById("project-name").placeholder=i18n[currentLang].projectNamePlaceholder,document.getElementById("save-btn").textContent=i18n[currentLang].save,document.getElementById("reedit-btn").textContent=i18n[currentLang].reedit,document.getElementById("criticize-btn").textContent=i18n[currentLang].criticize,document.getElementById("test-btn").textContent=i18n[currentLang].testHypothesis,document.getElementById("add-block-btn").textContent=i18n[currentLang].addBlock,document.getElementById("remove-block-btn").textContent=i18n[currentLang].removeBlock,document.getElementById("new-project-btn").textContent=i18n[currentLang].newProject,document.getElementById("my-projects-btn").textContent=i18n[currentLang].myProjects,document.getElementById("delete-project-btn").textContent=i18n[currentLang].deleteProject,document.getElementById("export-pdf-btn").textContent=i18n[currentLang].exportPDF,document.querySelector("#help-btn").textContent=i18n[currentLang].help,renderBlocks()}function toggleDarkMode(){const e=document.getElementById("dark-mode-toggle").checked;document.documentElement.setAttribute("data-theme",e?"dark":"light"),localStorage.setItem("darkMode",e)}function applyTheme(){const e="true"===localStorage.getItem("darkMode");document.getElementById("dark-mode-toggle").checked=e,document.documentElement.setAttribute("data-theme",e?"dark":"light")}let currentProject={id:generateUUID(),nome:"Novo Projeto",status:"Novo",idioma:"pt",framework:"",template:"",blocos:[],salvoEm:"",ultimaAtualizacao:(new Date).toISOString()},selectedBlockId=null,currentLang="pt";document.addEventListener("DOMContentLoaded",()=>{initializeApp(),setupEventListeners(),loadFrameworks(),loadTemplates(),applyTheme(),applyLanguage()});