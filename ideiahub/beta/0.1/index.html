<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IdeiaHub</title>
  <link rel="icon" href="data:," />
  <!-- Feather Icons -->
  <script src="https://unpkg.com/feather-icons"></script>
  <!-- html2pdf.js -->
  <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-YcsIPNR6DcnZ6G9vBvYqLZ5k6bK2zFf9Q1k1Q6m8t6pW2YkXn0Z0aHnQxD8Y5p0wAqz8W3c1u3n9G0t+9am9Vw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>-->
    src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"> 
    <!--a linha 12 foi adicionada para corrigir um problema-->
  <style>
    :root {
      --bg: #0f1115;
      --panel: #151922;
      --panel-2: #1b2130;
      --text: #e7ecf3;
      --muted: #aab4c4;
      --primary: #6aa7ff;
      --primary-weak: rgba(106,167,255,.15);
      --border: #263043;
      --accent: #8ef0c8;
      --warn: #ffb84d;
      --danger: #ff6b6b;
      --shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    [data-theme="light"] {
      --bg: #f7f8fb;
      --panel: #ffffff;
      --panel-2: #f2f4f8;
      --text: #1b2330;
      --muted: #516078;
      --primary: #3b82f6;
      --primary-weak: rgba(59,130,246,.12);
      --border: #e5e9f2;
      --accent: #17b282;
      --warn: #b77400;
      --danger: #d94646;
      --shadow: 0 8px 24px rgba(17,24,39,.08);
    }

    * { box-sizing: border-box }
    html, body { height: 100% }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font: 15px/1.5 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    .app {
      display: grid;
      grid-template-columns: 280px 1fr;
      grid-template-rows: 64px 1fr;
      grid-template-areas:
        "sidebar topbar"
        "sidebar main";
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      grid-area: sidebar;
      background: var(--panel);
      border-right: 1px solid var(--border);
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--panel), var(--panel-2));
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
    }
    .brand .logo {
      width: 34px; height: 34px; border-radius: 12px;
      background: radial-gradient(120px 120px at 0% 100%, var(--accent), transparent),
                  radial-gradient(120px 120px at 100% 0%, var(--primary), transparent);
      flex-shrink: 0;
    }
    .brand .title {
      display: flex; flex-direction: column;
      line-height: 1.1;
    }
    .brand .title strong { font-size: 16px }
    .brand .title span { font-size: 12px; color: var(--muted) }

    .nav {
      display: flex; flex-direction: column; gap: 6px;
    }
    .nav-btn {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid transparent;
      color: var(--text);
      background: transparent;
      cursor: pointer;
      transition: .2s ease;
      font-weight: 500;
    }
    .nav-btn:hover {
      background: var(--panel-2);
      border-color: var(--border);
      transform: translateY(-1px);
    }
    .nav-btn .icon { width: 18px; height: 18px; color: var(--muted) }
    .nav-section-title {
      margin-top: 8px;
      font-size: 12px;
      color: var(--muted);
      letter-spacing: .08em;
      text-transform: uppercase;
      padding: 0 4px;
    }

    .premium-badge {
      margin-left: auto;
      font-size: 11px;
      color: var(--warn);
      background: rgba(255,184,77,.12);
      border: 1px dashed rgba(255,184,77,.5);
      padding: 2px 6px;
      border-radius: 6px;
    }

    .sidebar-footer {
      margin-top: auto;
      display: grid; gap: 8px;
    }
    .disabled {
      opacity: .55; cursor: not-allowed;
    }

    /* Topbar */
    .topbar {
      grid-area: topbar;
      background: var(--panel);
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; gap: 12px;
      padding: 0 16px;
    }
    .project-title {
      flex: 1;
      display: flex; align-items: baseline; gap: 8px;
    }
    .project-name {
      font-size: 18px; font-weight: 700;
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--panel-2);
      min-width: 140px;
      color: var(--text);
      outline: none;
    }
    .status-chip {
      font-size: 12px; color: var(--muted);
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--panel-2);
    }

    .topbar-actions {
      display: flex; align-items: center; gap: 8px;
    }
    .btn {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 12px; border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--panel-2);
      color: var(--text); cursor: pointer;
      transition: .2s ease;
      font-weight: 600;
    }
    .btn:hover { transform: translateY(-1px) }
    .btn.primary {
      background: var(--primary-weak);
      border-color: rgba(106,167,255,.35);
      color: var(--primary);
    }
    .btn.danger { border-color: rgba(255,107,107,.4); color: var(--danger); background: rgba(255,107,107,.08) }
    .btn.premium { border-style: dashed; color: var(--warn); background: rgba(255,184,77,.12) }
    .btn .icon { width: 18px; height: 18px }

    .theme-toggle {
      width: 40px; height: 36px; display: inline-flex; align-items:center; justify-content: center;
      border: 1px solid var(--border); border-radius: 10px;
      background: var(--panel-2); cursor: pointer;
    }

    /* Main / Canvas */
    .main {
      grid-area: main;
      display: grid;
      grid-template-rows: auto 1fr;
      gap: 12px;
      padding: 16px;
      background:
        radial-gradient(600px 200px at 0% 0%, rgba(106,167,255,.08), transparent 60%),
        radial-gradient(600px 200px at 100% 0%, rgba(142,240,200,.08), transparent 60%),
        var(--bg);
    }

    .toolbar {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 10px;
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 10px;
      box-shadow: var(--shadow);
    }
    .selectors {
      display: flex; align-items: center; gap: 8px; flex-wrap: wrap;
    }
    .select {
      appearance: none;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--panel-2);
      color: var(--text);
      min-width: 210px;
      outline: none;
      background-image: url("data:image/svg+xml,%3Csvg width='18' height='18' xmlns='http://www.w3.org/2000/svg' fill='%23aab4c4'%3E%3Cpath d='M5 7l4 4 4-4' stroke='%23aab4c4' stroke-width='2' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 18px;
    }
    .toolbar-actions { display: flex; gap: 8px; align-items:center }

    .canvas {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      overflow: auto;
      min-height: 400px;
      box-shadow: var(--shadow);
    }
    .blocks {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 12px;
    }
    .block {
      grid-column: span 6;
      background: var(--panel-2);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 12px;
      transition: .15s ease;
      display: flex; flex-direction: column; gap: 8px;
      position: relative;
    }
    .block:hover { transform: translateY(-1px) }
    .block h4 {
      margin: 0;
      font-size: 14px;
      color: var(--muted);
      letter-spacing: .02em;
    }
    .block .content {
      min-height: 90px;
      padding: 10px;
      border-radius: 10px;
      border: 1px dashed var(--border);
      outline: none;
      background: transparent;
      color: var(--text);
      white-space: pre-wrap;
    }
    .block .hint {
      font-size: 12px; color: var(--muted);
    }
    .block .pin {
      position: absolute; right: 10px; top: 10px;
      font-size: 10px; color: var(--primary);
      background: var(--primary-weak);
      border: 1px solid rgba(106,167,255,.35);
      padding: 2px 6px; border-radius: 999px;
    }

    .grid-12 { grid-column: span 12 }
    .grid-8 { grid-column: span 8 }
    .grid-4 { grid-column: span 4 }
    .grid-3 { grid-column: span 3 }
    .grid-6 { grid-column: span 6 }

    @media (max-width: 1100px) {
      .block { grid-column: span 12 }
    }

    /* Empty state */
    .empty {
      display: grid;
      place-items: center;
      min-height: 50px;
      color: var(--muted);
      border: 2px dashed var(--border);
      border-radius: 14px;
      background: repeating-linear-gradient(45deg, transparent 0 10px, rgba(255,255,255,.02) 10px 20px);
    }

    /* Toasts */
    .toast {
      position: fixed; right: 16px; bottom: 16px;
      display: grid; gap: 8px;
      z-index: 99;
    }
    .toast-item {
      display: flex; align-items: center; gap: 10px;
      background: var(--panel);
      border: 1px solid var(--border);
      border-left: 4px solid var(--primary);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 10px;
      box-shadow: var(--shadow);
      animation: slideIn .25s ease;
    }
    .toast-item.success { border-left-color: var(--accent) }
    .toast-item.warn { border-left-color: var(--warn) }
    .toast-item.error { border-left-color: var(--danger) }
    @keyframes slideIn {
      from { transform: translateY(10px); opacity: 0 } to { transform: translateY(0); opacity: 1 }
    }

    /* Modals */
    .modal-backdrop {
      position: fixed; inset: 0; background: rgba(0,0,0,.4);
      display: none; align-items: center; justify-content: center;
      z-index: 98;
    }
    .modal {
      width: min(680px, 92vw);
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      box-shadow: var(--shadow);
    }
    .modal-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 8px;
    }
    .modal-title { font-weight: 800 }
    .modal-body { display: grid; gap: 12px; max-height: 55vh; overflow: auto }
    .modal-actions { display: flex; justify-content: flex-end; gap: 8px; margin-top: 8px }
    .checklist { display: grid; gap: 8px; }
    .check-item { display: flex; align-items: flex-start; gap: 10px; }
    .check-item input { margin-top: 3px }

    /* Projects list modal */
    .projects-list { display: grid; gap: 8px }
    .project-card {
      display: grid; grid-template-columns: 1fr auto;
      gap: 8px; align-items: center;
      padding: 10px; border: 1px solid var(--border);
      border-radius: 12px; background: var(--panel-2);
    }
    .project-meta { display: flex; gap: 10px; align-items: baseline; color: var(--muted) }
    .project-actions { display: flex; gap: 6px }

    /* Premium lock */
    .locked {
      position: relative;
      opacity: .85;
    }
    .locked::after {
      content: "Premium";
      position: absolute; inset: 0;
      display: grid; place-items: center;
      color: var(--warn);
      background: rgba(0,0,0,.25);
      border-radius: inherit;
      font-weight: 800; letter-spacing: .06em;
      text-transform: uppercase;
    }

    /* helper */
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0 }

    /* código para manter as barras de controles fixas e mover apenas o canvas */
    /* O documento ocupa 100% da altura e não rola a página, apenas o centro */
html, body {
  height: 100%;
  overflow: hidden; /* bloqueia scroll global */
}

/* Grid principal ocupando toda a viewport */
.app {
  height: 100vh; /* garante ocupar a viewport */
  display: grid;
  grid-template-columns: 280px 1fr;  /* sidebar | centro */
  grid-template-rows: 64px 1fr;      /* topbar | conteúdo */
  grid-template-areas:
    "sidebar topbar"
    "sidebar main";
}

/* Áreas fixas (sem scroll) */
.sidebar {
  grid-area: sidebar;
  overflow: hidden;       /* impede scroll na lateral (opcional) */
}

.topbar {
  grid-area: topbar;
  position: sticky;       /* não é necessário se usamos overflow no main, mas mantém consistência */
  top: 0;
  z-index: 2;             /* fica acima do conteúdo */
  overflow: hidden;
}

/* Área central com scroll interno */
.main {
  grid-area: main;
  min-height: 0;          /* importante: permite que o filho com overflow funcione */
  overflow: hidden;       /* evita scroll duplo; quem rola é o canvas */
  display: flex;
  flex-direction: column;
}

/* Canvas rola verticalmente */
.canvas {
  flex: 1 1 auto;
  overflow: auto;         /* rolagem aqui */
  /* opcional: altura mínima, padding etc já existentes */
}

  </style>
</head>
<body data-theme="dark">
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="title">
          <strong>IdeiaHub</strong>
          <span>Estruture e evolua ideias</span>
        </div>
      </div>

      <div class="nav">
        <button class="nav-btn" id="newProjectBtn">
          <i data-feather="plus" class="icon"></i>
          Novo Projeto
        </button>
        <button class="nav-btn" id="myProjectsBtn">
          <i data-feather="folder" class="icon"></i>
          Meus Projetos
        </button>
        <button class="nav-btn" id="exportBtnSidebar">
          <i data-feather="download" class="icon"></i>
          Exportar
        </button>
        <button class="nav-btn" id="premiumBtnSidebar">
          <i data-feather="star" class="icon"></i>
          Premium
          <span class="premium-badge">Em breve</span>
        </button>
      </div>

      <div class="nav-section-title">Ações</div>
      <div class="nav">
        <button class="nav-btn" id="deleteProjectBtn">
          <i data-feather="trash-2" class="icon"></i>
          Deletar Projeto
        </button>
        <button class="nav-btn disabled" title="Login em breve" disabled>
          <i data-feather="user" class="icon"></i>
          Login
          <span class="premium-badge">Em breve</span>
        </button>
      </div>

      <div class="sidebar-footer">
        <small style="color:var(--muted)">Local • IndexedDB</small>
        <small style="color:var(--muted)">v0.1 Beta</small>
      </div>
    </aside>

    <!-- Topbar -->
    <header class="topbar">
      <div class="project-title">
        <input class="project-name" id="projectName" value="Projeto sem título" />
        <span class="status-chip" id="statusChip">editando</span>
      </div>
      <div class="topbar-actions">
        <button class="btn" id="saveBtn"><i data-feather="save" class="icon"></i>Salvar</button>
        <button class="btn" id="resetTemplateBtn"><i data-feather="rotate-ccw" class="icon"></i>Reeditar</button>
        <button class="btn primary" id="exportPdfBtn"><i data-feather="file-text" class="icon"></i>Exportar PDF</button>
        <button class="btn premium" id="testHypothesisBtn"><i data-feather="check-circle" class="icon"></i>Testar Hipótese</button>
        <button class="theme-toggle" id="themeToggle" title="Alternar tema">
          <i data-feather="moon" class="icon"></i>
        </button>
      </div>
    </header>

    <!-- Main -->
    <main class="main">
      <div class="toolbar">
        <div class="selectors">
          <label class="sr-only" for="frameworkSelect">Framework</label>
          <select id="frameworkSelect" class="select" title="Frameworks">
            <option value="">Selecione um Framework</option>
            <option>Lean Canvas Expandido</option>
            <option>Proposta de Valor (VPC)</option>
            <option>Mini Roadmap de Projeto</option>
            <option>Pitch Rápido</option>
            <option>Canvas do IdeiaHub (custom)</option>
            <option>SWOT Simplificado</option>
            <option>OKRs de Projeto</option>
            <option>Product Management Canvas</option>
            <option>Roadmap Trimestral</option>
            <option>BRD — Requisitos de Negócio</option>
            <option>PRD — Requisitos de Produto</option>
            <option>Cartão de Experimento Lean</option>
            <option>Go-To-Market (GTM) Lite</option>
            <option>Plano de Entrevista com Clientes</option>
            <option>Mapa da Jornada do Cliente (Lite)</option>
            <option>Brief de Funcionalidade</option>
            <option>Estratégia de Precificação</option>
          </select>

          <label class="sr-only" for="templateSelect">Template</label>
          <select id="templateSelect" class="select" title="Templates">
            <option value="">Selecione um Template</option>
            <option>Clube de Horta Urbana</option>
            <option>Correção Colaborativa de Redações</option>
            <option>Feira Online do Bairro</option>
            <option>App de Roteiros de Caminhadas Locais</option>
            <option>Plataforma de Troca de Habilidades</option>
            <option>Loja Virtual de Produtos Artesanais Locais</option>
            <option>Painel de Indicadores para Pequenos Negócios</option>
            <option>Rede de Apoio a Mães Empreendedoras</option>
            <option>Projeto Educacional Gamificado</option>
            <option>Central de Ofertas Comunitárias</option>
          </select>
        </div>
        <div class="toolbar-actions">
          <button class="btn" id="addBlockBtn"><i data-feather="square" class="icon"></i>Novo Bloco</button>
        </div>
        <div class="toolbar-actions">
          <button class="btn" id="exportBtn"><i data-feather="download" class="icon"></i>Exportar Projeto</button>
        </div>
      </div>

      <section class="canvas" id="canvas">
        <div class="empty" id="emptyState">Selecione um framework ou template para começar.</div>
        <div class="blocks" id="blocks" hidden></div>
      </section>
    </main>
  </div>

  <!-- Toasts -->
  <div class="toast" id="toast"></div>

  <!-- Modals -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal" id="genericModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">Modal</div>
        <button class="btn" id="modalClose"><i data-feather="x" class="icon"></i>Fechar</button>
      </div>
      <div class="modal-body" id="modalBody"></div>
      <div class="modal-actions" id="modalActions"></div>
    </div>
  </div>

  <script>
    // Icons
    feather.replace();

    // Simple state
    const state = {
      currentProjectId: null,
      currentFramework: "",
      currentTemplate: "",
      blocks: [], // { id, title, hint, content, span }
      dirty: false,
      theme: localStorage.getItem("ideiahub.theme") || "dark",
    };

    // DOM elements
    const els = {
      projectName: document.getElementById('projectName'),
      statusChip: document.getElementById('statusChip'),
      frameworkSelect: document.getElementById('frameworkSelect'),
      templateSelect: document.getElementById('templateSelect'),
      blocks: document.getElementById('blocks'),
      empty: document.getElementById('emptyState'),
      toast: document.getElementById('toast'),
      modalBackdrop: document.getElementById('modalBackdrop'),
      modalTitle: document.getElementById('modalTitle'),
      modalBody: document.getElementById('modalBody'),
      modalActions: document.getElementById('modalActions'),
      modalClose: document.getElementById('modalClose'),
    };

    // Theme
    document.body.setAttribute('data-theme', state.theme);
    document.getElementById('themeToggle').addEventListener('click', () => {
      state.theme = state.theme === 'dark' ? 'light' : 'dark';
      document.body.setAttribute('data-theme', state.theme);
      localStorage.setItem("ideiahub.theme", state.theme);
      toast('Tema alternado', 'success');
    });

    // Framework definitions
    const frameworks = {
      "Lean Canvas Expandido": [
        { title: "Nome do Projeto", hint: "Um nome claro e memorável.", span: 6 },
        { title: "Problema", hint: "Que problema real você resolve?", span: 6 },
        { title: "Solução", hint: "Como sua solução endereça o problema?", span: 6 },
        { title: "Proposta de Valor", hint: "O que torna sua solução única?", span: 6 },
        { title: "Público/Segmentos", hint: "Quem são os usuários ou clientes?", span: 6 },
        { title: "Canais", hint: "Como você chega ao público?", span: 6 },
        { title: "MVP", hint: "Qual é o mínimo para testar valor?", span: 6 },
        { title: "Validação", hint: "Como você medirá o sucesso inicial?", span: 6 },
        { title: "OKRs", hint: "Objetivos e resultados-chave.", span: 6 },
        { title: "Custos", hint: "Principais custos.", span: 6 },
        { title: "Receitas", hint: "Fontes de receita.", span: 6 }
      ],
      "Proposta de Valor (VPC)": [
        { title: "Cliente-Alvo", hint: "Quem é o cliente e contexto?", span: 6 },
        { title: "Tarefas do Cliente", hint: "O que tentam realizar?", span: 6 },
        { title: "Dores", hint: "Obstáculos e frustrações.", span: 6 },
        { title: "Ganhos", hint: "Resultados desejados.", span: 6 },
        { title: "Produtos/Serviços", hint: "O que você oferece?", span: 6 },
        { title: "Aliviadores de Dor", hint: "Como reduz as dores?", span: 6 },
        { title: "Criadores de Ganho", hint: "Como gera ganhos?", span: 6 }
      ],
      "Mini Roadmap de Projeto": [
        { title: "Objetivo", hint: "Resultado principal do período.", span: 12 },
        { title: "Marcos", hint: "Etapas chave.", span: 6 },
        { title: "Tarefas", hint: "Lista priorizada.", span: 6 },
        { title: "Riscos/Dependências", hint: "O que pode impactar.", span: 12 }
      ],
      "Pitch Rápido": [
        { title: "Problema", hint: "", span: 6 },
        { title: "Solução", hint: "", span: 6 },
        { title: "Diferencial", hint: "", span: 6 },
        { title: "Mercado", hint: "", span: 6 },
        { title: "Tração/Provas", hint: "", span: 6 },
        { title: "Call-to-Action", hint: "", span: 6 },
      ],
      "Canvas do IdeiaHub (custom)": [
        { title: "Visão", hint: "Onde queremos chegar?", span: 12 },
        { title: "Usuários", hint: "", span: 6 },
        { title: "Solução", hint: "", span: 6 },
        { title: "Métricas-Chave", hint: "", span: 6 },
        { title: "Experimentos", hint: "", span: 6 },
        { title: "Roadmap", hint: "", span: 12 },
      ],
      "SWOT Simplificado": [
        { title: "Forças", hint: "", span: 6 },
        { title: "Fraquezas", hint: "", span: 6 },
        { title: "Oportunidades", hint: "", span: 6 },
        { title: "Ameaças", hint: "", span: 6 },
      ],
      "OKRs de Projeto": [
        { title: "Objetivo", hint: "Inspira e direciona.", span: 12 },
        { title: "KR1", hint: "Mensurável e claro.", span: 4 },
        { title: "KR2", hint: "Mensurável e claro.", span: 4 },
        { title: "KR3", hint: "Mensurável e claro.", span: 4 },
        { title: "Iniciativas", hint: "O que faremos para alcançar.", span: 12 },
      ],
      "Product Management Canvas": [
        { title: "Problema", hint: "", span: 6 },
        { title: "Público", hint: "", span: 6 },
        { title: "Proposta de Valor", hint: "", span: 6 },
        { title: "Métricas", hint: "", span: 6 },
        { title: "Canais", hint: "", span: 6 },
        { title: "Monetização", hint: "", span: 6 },
      ],
      "Roadmap Trimestral": [
        { title: "Q Objetivos", hint: "", span: 12 },
        { title: "Em Andamento", hint: "", span: 6 },
        { title: "Próximo", hint: "", span: 6 },
        { title: "Riscos", hint: "", span: 12 },
      ],
      "BRD — Requisitos de Negócio": [
        { title: "Contexto", hint: "", span: 12 },
        { title: "Stakeholders", hint: "", span: 6 },
        { title: "Objetivos de Negócio", hint: "", span: 6 },
        { title: "Escopo", hint: "", span: 12 },
        { title: "Critérios de Sucesso", hint: "", span: 12 },
      ],
      "PRD — Requisitos de Produto": [
        { title: "Visão do Produto", hint: "", span: 12 },
        { title: "Usuários & Personas", hint: "", span: 6 },
        { title: "Funcionalidades", hint: "", span: 6 },
        { title: "Requisitos Funcionais", hint: "", span: 6 },
        { title: "Requisitos Não-Funcionais", hint: "", span: 6 },
        { title: "Métricas", hint: "", span: 6 },
      ],
      "Cartão de Experimento Lean": [
        { title: "Hipótese", hint: "", span: 12 },
        { title: "Métrica Sucesso", hint: "", span: 6 },
        { title: "Plano de Teste", hint: "", span: 6 },
        { title: "Resultado", hint: "", span: 12 },
        { title: "Aprendizados", hint: "", span: 12 },
      ],
      "Go-To-Market (GTM) Lite": [
        { title: "Segmento-Alvo", hint: "", span: 6 },
        { title: "Proposta de Valor", hint: "", span: 6 },
        { title: "Canais", hint: "", span: 6 },
        { title: "Mensagem", hint: "", span: 6 },
        { title: "Táticas Iniciais", hint: "", span: 12 },
      ],
      "Plano de Entrevista com Clientes": [
        { title: "Objetivo da Entrevista", hint: "", span: 12 },
        { title: "Perfil dos Entrevistados", hint: "", span: 6 },
        { title: "Roteiro de Perguntas", hint: "", span: 6 },
        { title: "Notas", hint: "", span: 12 },
      ],
      "Mapa da Jornada do Cliente (Lite)": [
        { title: "Estágios", hint: "Descoberta > Consideração > Decisão > Retenção", span: 12 },
        { title: "Ações do Cliente", hint: "", span: 12 },
        { title: "Pontos de Dor", hint: "", span: 6 },
        { title: "Oportunidades", hint: "", span: 6 },
      ],
      "Brief de Funcionalidade": [
        { title: "Resumo", hint: "", span: 12 },
        { title: "Problema", hint: "", span: 6 },
        { title: "Solução Proposta", hint: "", span: 6 },
        { title: "Critérios de Aceite", hint: "", span: 12 },
      ],
      "Estratégia de Precificação": [
        { title: "Proposta de Valor", hint: "", span: 12 },
        { title: "Segmentos/Planos", hint: "", span: 6 },
        { title: "Preço Inicial", hint: "", span: 6 },
        { title: "Teste & Validação", hint: "", span: 12 },
      ],
    };

    // Templates content (examples)
    const templates = {
      "Clube de Horta Urbana": {
        "Nome do Projeto": "HortaClub",
        "Problema": "Moradores urbanos têm pouco acesso a espaços verdes e alimentos frescos.",
        "Solução": "Clubes de hortas compartilhadas em prédios e bairros com kits e mentorias.",
        "Público/Segmentos": "Moradores de apartamentos, síndicos, escolas.",
        "Canais": "Parcerias com condomínios, redes sociais locais, feiras de bairro.",
        "MVP": "Instalação de 1 horta piloto em um prédio e encontros semanais.",
        "Validação": "Número de participantes ativos e safra colhida em 60 dias.",
        "OKRs": "O: Validar interesse; KR1: 30 participantes; KR2: 2 colheitas/mês"
      },
      "Correção Colaborativa de Redações": {
        "Problema": "Estudantes carecem de feedback rápido e qualificado.",
        "Solução": "Plataforma com correção por pares e monitores.",
        "Público": "Alunos de ensino médio, cursinhos.",
        "Canais": "Parcerias com escolas, influenciadores educacionais.",
        "MVP": "Turma piloto com 50 alunos e 2 correções semanais."
      },
      "Feira Online do Bairro": {
        "Problema": "Produtores locais não alcançam compradores digitais.",
        "Solução": "Marketplace hiperlocal com logística colaborativa.",
        "Canais": "Grupos de WhatsApp, associações de bairro.",
        "MVP": "Landing + catálogo simples + entregas em um dia fixo."
      },
      "App de Roteiros de Caminhadas Locais": {
        "Problema": "Falta de rotas seguras e interessantes nas redondezas.",
        "Solução": "App com roteiros curados e gamificação.",
        "MVP": "Mapa com 5 rotas e sistema de badges."
      },
      "Plataforma de Troca de Habilidades": {
        "Problema": "Pessoas querem aprender sem alto custo.",
        "Solução": "Créditos por aula ensinada para aprender outra habilidade.",
      },
      "Loja Virtual de Produtos Artesanais Locais": {
        "Problema": "Artesãos têm pouca presença online.",
        "Solução": "Loja compartilhada com vitrine e logística simples.",
        "Proposta de Valor":"Teste",
        "Público/Segmentos":"Luiz",
        "Canais":"Canal",
        "MVP":"Produto",
        "Validação":"Valido",
        "OKRs":"kit",
        "Custos":"preço",
        "Receitas":"R$",
      },
      "Painel de Indicadores para Pequenos Negócios": {
        "Problema": "Empreendedores não têm visão consolidada de indicadores.",
        "Solução": "Dashboard simples integrado a planilhas.",
      },
      "Rede de Apoio a Mães Empreendedoras": {
        "Problema": "Falta de networking e suporte flexível.",
        "Solução": "Comunidade, mentorias e marketplace.",
      },
      "Projeto Educacional Gamificado": {
        "Problema": "Baixa motivação em estudos remotos.",
        "Solução": "Metas, missões e recompensas.",
      },
      "Central de Ofertas Comunitárias": {
        "Problema": "Ofertas locais se perdem em vários canais.",
        "Solução": "Hub único de promoções do bairro.",
      },
    };

    // IndexedDB setup
    const DB_NAME = 'ideiahub_db';
    const DB_STORE = 'projects';
    let db;

   function openDB() {
return new Promise((resolve, reject) => {
const req = indexedDB.open(DB_NAME, 2); // versão 2
req.onupgradeneeded = (e) => {
const db = e.target.result;
if (!db.objectStoreNames.contains(DB_STORE)) {
db.createObjectStore(DB_STORE, { keyPath: 'id', autoIncrement: true });
}
};
req.onsuccess = () => { db = req.result; resolve(db); };
req.onerror = () => reject(req.error);
});
}

    function dbTx(mode='readonly') {
      const tx = db.transaction(DB_STORE, mode);
      return { tx, store: tx.objectStore(DB_STORE) };
    }

    function saveProject() {
  if (!db) {
    alert("Banco de dados ainda não está disponível.");
    return;
  }

  const camposProjeto = getCamposProjeto();
  const tipoProjeto = document.querySelector('input[name="tipoProjeto"]:checked')?.value;

  if (!tipoProjeto || !camposProjeto) {
    alert("Selecione um tipo de projeto e preencha os campos.");
    return;
  }

  const projeto = {
    id: projetoAtualId || crypto.randomUUID(), // ✅ Gera ID se não houver
    tipo: tipoProjeto,
    dados: camposProjeto,
    timestamp: new Date().toISOString()
  };

  const tx = db.transaction(["projetos"], "readwrite");
  const store = tx.objectStore("projetos");
  const request = store.put(projeto);

  request.onsuccess = () => {
    projetoAtualId = projeto.id; // ✅ Atualiza ID atual após salvar
    alert("Projeto salvo com sucesso!");
  };

  request.onerror = (event) => {
    console.error("Erro ao salvar o projeto:", event.target.error);
    alert("Erro ao salvar o projeto.");
  };
}

    async function listProjects() {
      if (!db) await openDB();
      const { tx, store } = dbTx('readonly');
      const req = store.getAll();
      return new Promise((resolve, reject) => {
        req.onsuccess = () => resolve(req.result.sort((a,b)=> new Date(b.updatedAt)-new Date(a.updatedAt)));
        req.onerror = () => reject(req.error);
      });
    }

    async function getProject(id) {
      if (!db) await openDB();
      const { tx, store } = dbTx('readonly');
      const req = store.get(id);
      return new Promise((resolve, reject) => {
        req.onsuccess = () => resolve(req.result);
        req.onerror = () => reject(req.error);
      });
    }

    async function deleteProject(id) {
      if (!db) await openDB();
      const { tx, store } = dbTx('readwrite');
      const req = store.delete(id);
      return new Promise((resolve, reject) => {
        req.onsuccess = () => resolve(true);
        req.onerror = () => reject(req.error);
      });
    }

    // UI helpers
    function setStatus(s) {
      els.statusChip.textContent = s;
    }
    function toast(msg, type='') {
      const el = document.createElement('div');
      el.className = `toast-item ${type}`;
      el.innerHTML = `<i data-feather="${type==='error'?'alert-triangle': type==='success'?'check': type==='warn'?'alert-circle':'info'}" class="icon"></i><span>${msg}</span>`;
      els.toast.appendChild(el);
      feather.replace();
      setTimeout(()=> {
        el.style.opacity = '0';
        setTimeout(()=> el.remove(), 250);
      }, 2500);
    }
    function openModal(title, bodyNode, actions=[]) {
      els.modalTitle.textContent = title;
      els.modalBody.innerHTML = '';
      els.modalBody.appendChild(bodyNode);
      els.modalActions.innerHTML = '';
      actions.forEach(a=>{
        const b = document.createElement('button');
        b.className = `btn ${a.variant||''}`;
        b.innerHTML = a.icon ? `<i data-feather="${a.icon}" class="icon"></i>${a.label}` : a.label;
        b.addEventListener('click', a.onClick);
        els.modalActions.appendChild(b);
      });
      feather.replace();
      els.modalBackdrop.style.display = 'flex';
    }
    function closeModal() { els.modalBackdrop.style.display = 'none'; }
    els.modalClose.addEventListener('click', closeModal);
    els.modalBackdrop.addEventListener('click', (e)=> { if (e.target === els.modalBackdrop) closeModal(); });

    // Blocks rendering
    function renderBlocks() {
      if (!state.blocks.length) {
        els.empty.hidden = false;
        els.blocks.hidden = true;
        return;
      }
      els.empty.hidden = true;
      els.blocks.hidden = false;
      els.blocks.innerHTML = '';
      state.blocks.forEach(block => {
        const div = document.createElement('div');
        const spanClass = block.span ? `grid-${block.span}` : 'grid-6';
        div.className = `block ${spanClass}`;
        div.dataset.id = block.id;
        div.innerHTML = `
          <span class="pin">${state.currentFramework || 'Bloco'}</span>
          <h4>${block.title}</h4>
          <div class="content" contenteditable="true" data-field="content" placeholder="">${escapeHtml(block.content||'')}</div>
          ${block.hint ? `<div class="hint">${block.hint}</div>` : ``}
        `;
        // listeners
        div.querySelector('.content').addEventListener('input', (e) => {
          const val = e.currentTarget.innerText;
          const b = state.blocks.find(x => x.id === block.id);
          b.content = val;
          state.dirty = true;
          setStatus('editando');
        });
        els.blocks.appendChild(div);
      });
    }

    function escapeHtml(txt) {
      const div = document.createElement('div');
      div.textContent = txt || '';
      return div.innerHTML;
    }

    function newProject(withConfirm=false) {
      const proceed = () => {
        state.currentProjectId = null;
        state.currentFramework = "";
        state.currentTemplate = "";
        state.blocks = [];
        state.dirty = false;
        els.projectName.value = "Novo Projeto";
        setStatus('novo');
        renderBlocks();
      };
      if (withConfirm && state.dirty) {
        confirmModal("Descartar alterações?", "Iniciar novo projeto pode descartar alterações não salvas.", proceed);
      } else {
        proceed();
      }
    }

    function confirmModal(title, msg, onConfirm) {
      const body = document.createElement('div');
      body.innerHTML = `<p style="color:var(--muted)">${msg}</p>`;
      openModal(title, body, [
        { label: 'Cancelar', icon: 'x', onClick: closeModal },
        { label: 'Confirmar', icon: 'check', variant: 'danger', onClick: ()=> { closeModal(); onConfirm(); } },
      ]);
    }

    // Framework & Template handlers
    function loadFramework(name) {
      const schema = frameworks[name];
      if (!schema) return;
      state.currentFramework = name;
      state.blocks = schema.map((s, idx) => ({
        id: crypto.randomUUID(),
        title: s.title,
        hint: s.hint || "",
        content: "",
        span: (s.span || 6)
      }));
      renderBlocks();
      setStatus('editando');
      toast(`Framework "${name}" carregado`, 'success');
    }

    function applyTemplate(name) {
      const contentMap = templates[name] || {};
      state.currentTemplate = name;
      let applied = 0;
      state.blocks.forEach(b => {
        if (contentMap[b.title] !== undefined) {
          b.content = contentMap[b.title];
          applied++;
        }
      });
      renderBlocks();
      setStatus('editando');
      toast(applied ? `Template "${name}" aplicado` : 'Template sem campos correspondentes', applied ? 'success':'warn');
    }

    // Export PDF
    function exportPDF() {
      if (!state.blocks.length) {
        toast('Nada para exportar. Selecione um framework.', 'warn');
        return;
      }
      const printable = document.createElement('div');
      printable.style.padding = '16px';
      printable.style.fontFamily = 'Inter, Arial, sans-serif';
      printable.style.color = '#111827';

      const title = document.createElement('h2');
      title.textContent = els.projectName.value + ' — ' + (state.currentFramework || 'IdeiaHub');
      printable.appendChild(title);

      state.blocks.forEach(b => {
        const sec = document.createElement('section');
        sec.style.marginBottom = '12px';
        const h = document.createElement('h3');
        h.textContent = b.title;
        h.style.margin = '6px 0';
        h.style.fontSize = '16px';
        const p = document.createElement('div');
        p.textContent = b.content || '';
        p.style.whiteSpace = 'pre-wrap';
        p.style.fontSize = '13px';
        p.style.border = '1px solid #e5e7eb';
        p.style.borderRadius = '8px';
        p.style.padding = '8px';
        sec.appendChild(h); sec.appendChild(p);
        printable.appendChild(sec);
      });

      const opt = {
        margin:       10,
        filename:     `${sanitizeFilename(els.projectName.value)}.pdf`,
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2, useCORS: true },
        jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };
      html2pdf().from(printable).set(opt).save().then(()=>{
        toast('Exportado com sucesso', 'success');
        setStatus('exportado');
      }).catch(()=>{
        toast('Falha ao exportar', 'error');
      });
    }
    function sanitizeFilename(name) {
      return (name || 'ideiahub').replace(/[\\/:*?"<>|]+/g,'_').slice(0,80);
    }

    // Projects modals
    async function showProjectsModal() {
      const list = await listProjects();
      const body = document.createElement('div');
      body.className = 'projects-list';
      if (!list.length) {
        body.innerHTML = `<div style="color:var(--muted)">Nenhum projeto salvo ainda.</div>`;
      } else {
        list.forEach(p => {
          const card = document.createElement('div');
          card.className = 'project-card';
          const left = document.createElement('div');
          left.innerHTML = `<strong>${escapeHtml(p.name)}</strong>
            <div class="project-meta">
              <span>${p.framework || 'Sem framework'}</span>
              <span>•</span>
              <span>${new Date(p.updatedAt).toLocaleString()}</span>
            </div>`;
          const actions = document.createElement('div');
          actions.className = 'project-actions';
          const openBtn = document.createElement('button');
          openBtn.className = 'btn';
          openBtn.innerHTML = `<i data-feather="folder-open" class="icon"></i>Abrir`;
          openBtn.addEventListener('click', async ()=> {
            const proj = await getProject(p.id);
            if (proj) {
              state.currentProjectId = proj.id;
              state.currentFramework = proj.framework || "";
              state.currentTemplate = proj.template || "";
              state.blocks = proj.blocks || [];
              els.projectName.value = proj.name || "Projeto";
              renderBlocks();
              setStatus('carregado');
              toast('Projeto carregado', 'success');
              closeModal();
            }
          });

          const delBtn = document.createElement('button');
          delBtn.className = 'btn danger';
          delBtn.innerHTML = `<i data-feather="trash-2" class="icon"></i>Deletar`;
          delBtn.addEventListener('click', ()=> {
            closeModal();
            confirmModal('Deletar projeto?', `Tem certeza que deseja deletar "${p.name}"?`, async () => {
              await deleteProject(p.id);
              toast('Projeto deletado', 'success');
            });
          });
          actions.appendChild(openBtn); actions.appendChild(delBtn);
          card.appendChild(left); card.appendChild(actions);
          body.appendChild(card);
        });
      }
      openModal('Meus Projetos', body, [{ label: 'Fechar', icon: 'x', onClick: closeModal }]);
      feather.replace();
    }

    // Premium modal (locked)
    function showHypothesisModal() {
      const body = document.createElement('div');
      body.className = 'checklist';
      body.innerHTML = `
        <div class="check-item">
          <input type="checkbox" disabled />
          <div>
            <strong>Você validou esse problema com usuários reais?</strong>
            <div style="color:var(--muted)">Converse com ao menos 5 pessoas do público-alvo.</div>
          </div>
        </div>
        <div class="check-item">
          <input type="checkbox" disabled />
          <div>
            <strong>O que torna sua solução melhor?</strong>
            <div style="color:var(--muted)">Liste 3 diferenciais claros.</div>
          </div>
        </div>
        <div class="check-item">
          <input type="checkbox" disabled />
          <div>
            <strong>Qual canal inicial para o MVP?</strong>
            <div style="color:var(--muted)">Escolha 1 canal para concentrar esforços.</div>
          </div>
        </div>
        <div class="check-item">
          <input type="checkbox" disabled />
          <div>
            <strong>Como você medirá sucesso?</strong>
            <div style="color:var(--muted)">Defina uma métrica simples e clara.</div>
          </div>
        </div>
        <div class="locked" style="height: 80px; border:1px dashed var(--border); border-radius:12px; display:grid; place-items:center; color:var(--muted);">Checklist interativo</div>
      `;
      openModal('Testar Hipótese (Premium)', body, [
        { label: 'Saiba mais', icon: 'star', onClick: ()=> { toast('Recurso Premium em breve', 'warn'); } },
        { label: 'Fechar', icon: 'x', onClick: closeModal },
      ]);
    }

    // Toolbar actions
    document.getElementById('exportPdfBtn').addEventListener('click', () => {
if (typeof html2pdf === 'undefined') {
toast('Módulo de PDF não carregou. Verifique sua conexão.', 'error');
return;
}
exportPDF();
});
document.getElementById('exportBtnSidebar').addEventListener('click', () => {
if (typeof html2pdf === 'undefined') {
toast('Módulo de PDF não carregou. Verifique sua conexão.', 'error');
return;
}
exportPDF();
});

    document.getElementById('saveBtn').addEventListener('click', saveProject);
    document.getElementById('exportBtn').addEventListener('click', ()=> { saveProject().then(()=> toast('Export JSON pronto', 'success')); });
    document.getElementById('resetTemplateBtn').addEventListener('click', ()=> {
      if (!state.currentFramework) return toast('Selecione um framework primeiro', 'warn');
      confirmModal('Recarregar Framework?', 'Isso limpa os conteúdos inseridos. Deseja continuar?', ()=> {
        loadFramework(state.currentFramework);
      });
    });
    document.getElementById('addBlockBtn').addEventListener('click', ()=> {
      state.blocks.push({
        id: crypto.randomUUID(),
        title: "Novo Bloco",
        hint: "",
        content: "",
        span: 6
      });
      state.dirty = true;
      renderBlocks();
      setStatus('editando');
    });

    // Sidebar actions
    document.getElementById('newProjectBtn').addEventListener('click', ()=> newProject(true));
    document.getElementById('myProjectsBtn').addEventListener('click', showProjectsModal);
    document.getElementById('premiumBtnSidebar').addEventListener('click', ()=> toast('Recursos Premium em breve', 'warn'));
    document.getElementById('deleteProjectBtn').addEventListener('click', ()=> {
      if (!state.currentProjectId) return toast('Nenhum projeto carregado', 'warn');
      confirmModal('Deletar projeto?', 'Essa ação não pode ser desfeita.', async ()=> {
        await deleteProject(state.currentProjectId);
        newProject();
        toast('Projeto deletado', 'success');
      });
    });

    // Selectors
    els.frameworkSelect.addEventListener('change', (e)=> {
      const name = e.target.value;
      if (!name) return;
      if (state.dirty) {
        confirmModal('Trocar framework?', 'Você possui alterações não salvas. Continuar?', ()=> loadFramework(name));
      } else {
        loadFramework(name);
      }
    });

    els.templateSelect.addEventListener('change', (e)=> {
      const name = e.target.value;
      if (!name) return;
      if (!state.currentFramework) {
        toast('Selecione um framework antes do template', 'warn');
        e.target.value = '';
        return;
      }
      applyTemplate(name);
    });

    // Project name changes
    els.projectName.addEventListener('input', ()=> {
      state.dirty = true; setStatus('editando');
    });

    // Load initial
    (async function init() {
      await openDB();
      setStatus('pronto');
    })();
  </script>
</body>
</html>